pnl = sum(scaled_managed_pnl)
) %>%
mutate(data_year = year(data_date)) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_year) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
# Chunk 9
df_sharpe %>% filter(loss_trigger == 1000)
df_sharpe %>%
filter(dh_threshold == 0) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point() +
labs(
title = "Halves - sharpe by loss-trigger (delta-hedge)"
)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point() +
labs(
title = "Halves - sharpe by loss-trigger (naked)"
)
df_sharpe_by_year %>%
filter(loss_trigger == 1000) %>%
filter(dh_threshold == 0) %>%
ggplot(aes(x=data_year, y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
labs(
title = "Halves - sharpe by year (delta-hedge)"
, subtitle = "no risk management"
)
df_sharpe_by_year %>%
filter(loss_trigger == 1000) %>%
filter(dh_threshold == 1) %>%
ggplot(aes(x=data_year, y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
labs(
title = "Halves - sharpe by year (naked)"
, subtitle = "no risk management"
)
# Chunk 10
# thirds
my_grouping <- function(rank){
if (rank %in% c(1, 2, 3, 4)) {
g = 1L
}
else if (rank %in% c(5, 6, 7, 8)) {
g = 2L
} else {
g = 3L
}
g
}
df_garch_weekly <-
df_garch_weekly %>%
mutate(
vol_prem_group = map_int(vol_prem_rank, my_grouping)
)
df_sharpe <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
# Chunk 11
df_sharpe %>% filter(loss_trigger == 1000)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point() +
labs(
title = "Thirds - sharpe by loss-trigger (delta-hedge)"
)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point() +
labs(
title = "Thirds - sharpe by loss-trigger (naked)"
)
# Chunk 12
# fourths
my_grouping <- function(rank){
if (rank %in% c(1, 2, 3)) {
g = 1L
}
else if (rank %in% c(4, 5, 6)) {
g = 2L
}
else if (rank %in% c(7, 8, 9)) {
g = 3L
} else {
g = 4L
}
g
}
df_garch_weekly <-
df_garch_weekly %>%
mutate(
vol_prem_group = map_int(vol_prem_rank, my_grouping)
)
df_sharpe <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
df_sharpe %>% filter(loss_trigger == 1000)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point()
# Chunk 13
# sixths
my_grouping <- function(rank){
if (rank %in% c(1, 2)) {
g = 1L
}
else if (rank %in% c(3, 4)) {
g = 2L
}
else if (rank %in% c(5, 6)) {
g = 3L
}
else if (rank %in% c(7, 8)) {
g = 4L
}
else if (rank %in% c(9, 10)) {
g = 5L
} else {
g = 6L
}
g
}
df_garch_weekly <-
df_garch_weekly %>%
mutate(
vol_prem_group = map_int(vol_prem_rank, my_grouping)
)
df_sharpe <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
df_sharpe %>% filter(loss_trigger == 1000)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point()
# Chunk 14
# twelfths
my_grouping <- function(rank){
g = as.integer(rank)
g
}
df_garch_weekly <-
df_garch_weekly %>%
mutate(
vol_prem_group = map_int(vol_prem_rank, my_grouping)
)
df_sharpe <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
df_sharpe %>% filter(loss_trigger == 1000)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_point()
df_sharpe %>%
filter(dh_threshold == 0) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
#geom_point() +
geom_smooth(se = FALSE, method = "loess", formula = "y ~ x") +
labs(
title = "Sixths - sharpe by loss-trigger (delta-hedged)"
)
df_sharpe %>%
filter(dh_threshold == 1) %>%
filter(loss_trigger != 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, color = factor(vol_prem_group))) +
geom_smooth(se = FALSE, method = "loess", formula = "y ~ x") +
labs(
title = "Sixths - sharpe by loss-trigger (naked)"
)
help(labs)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
gplot(aes(x=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
gplot(aes(x=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge")
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge")
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe)) +
geom_bar(stat = "identity", position = "dodge")
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# halves
my_grouping <- function(rank){
if (rank <= 6) {
g = 1L
}
else {
g = 2L
}
g
}
df_garch_weekly <-
df_garch_weekly %>%
mutate(
vol_prem_group = map_int(vol_prem_rank, my_grouping)
)
df_sharpe <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
df_sharpe_by_year <-
df_pnl_weekly %>%
left_join(
df_garch_weekly %>% select(underlying, expiration, vol_prem_group)
, by = c("underlying", "expiration")
) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_date) %>%
summarize(
pnl = sum(scaled_managed_pnl)
) %>%
mutate(data_year = year(data_date)) %>%
group_by(dh_threshold, loss_trigger, vol_prem_group, data_year) %>%
summarize(
sharpe = (mean(pnl) / sd(pnl)) * sqrt(252)
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe), fill=factor(vol_prem_group)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, fill=factor(vol_prem_group)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=loss_trigger, y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(loss_trigger), y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(loss_trigger), y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
labs(
title = "sharpe ration by group"
, subtitle = "faceted by hedging"
, fill = "group"
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(loss_trigger), y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
labs(
title = "sharpe ratio by group"
, subtitle = "faceted by hedging"
, fill = "group"
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(loss_trigger), y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
labs(
title = "sharpe ratio by group"
, subtitle = "faceted by hedging"
, fill = "group"
, x = "test"
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(loss_trigger), y=sharpe, fill=factor(vol_prem_group))) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
labs(
title = "sharpe ratio by group"
, subtitle = "faceted by hedging"
, fill = "group"
, x = "delta hedging"
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe, fill=factor(vol_prem_group))) +
geom_text(aes(label=round(sharpe, 2), vjust=-0.25)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
labs(
title = "sharpe ratio by group"
, subtitle = "faceted by hedging"
, fill = "group"
, x = "group"
)
# sharpes for no risk management
df_sharpe %>%
filter(loss_trigger == 1000) %>%
ggplot(aes(x=factor(vol_prem_group), y=sharpe, fill=factor(vol_prem_group))) +
geom_text(aes(label=round(sharpe, 2), vjust=-0.25)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~dh_threshold) +
ylim(0, 1.55) +
labs(
title = "Halves - sharpe ratio by group"
, subtitle = "faceted by hedging"
, fill = "group"
, x = "group"
)
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n)) %>%
ggplot(x = underlying, y =n) +
geom_bar(stat = "identity")
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n)) %>%
ggplot(aes(x = underlying, y = n)) +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(reorder(row.names(df_counts), n), y = n)) +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(row.names(df_counts), n), y = n)) +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(row.names(df_counts), n), y = n)) +
coord_flip() +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(row.names(df_counts), underlying), y = n)) +
coord_flip() +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(underlying, n), y = n)) +
coord_flip() +
geom_bar(stat = "identity")
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(underlying, n), y = n)) +
coord_flip() +
geom_bar(stat = "identity") +
labs(
Title: "Number of times in top group"
, x = "count"
, y = "underlying"
)
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(underlying, n), y = n)) +
coord_flip() +
geom_bar(stat = "identity") +
labs(
title: "Number of times in top group"
, x = "count"
, y = "underlying"
)
df_counts <-
df_garch_weekly %>%
filter(vol_prem_group == 1) %>%
group_by(underlying) %>%
tally() %>%
arrange(desc(n))
df_counts %>%
ggplot(aes(x=reorder(underlying, n), y = n)) +
coord_flip() +
geom_bar(stat = "identity") +
labs(
title = "Number of times in top group"
, x = "count"
, y = "underlying"
)
unlink('analysis/04_garch_forecaste_cache', recursive = TRUE)
