read_csv("data_output/spy_weekly_2014_2018_opt_hist.csv")
df_td_all <-
bizseq(from = "2014-01-03", to = "2018-12-29")
bizseq(from = "2014-01-03", to = "2018-12-29")
#####################
## all trade dates ##
#####################
df_td_all <-
tibble(
trade_date = bizseq(from = "2014-01-03", to = "2018-12-29")
)
df_underlying_px <-
tq_get("SPY", from = "2014-01-03", to = "2018-12-29")
df_vol_index <-
tq_get(
"VIXCLS"
, get = "economic.data"
, from = "2014-01-03"
, to = "2018-12-29"
)
df_chain_desc %>%
filter(d2x < 4)
# 2) make sure there are at least 6 options per chain
df_chain_desc %>%
filter(num_opts < 6)
# 3) make sure exec_day_volume is greater than 1000
df_chain_desc %>%
filter(exec_day_volume < 1000)
#####################################
## checking for missing price data ##
#####################################
df_td_all %>%
left_join(
df_chain_hist
, by = "trade_date"
)
#####################################
## checking for missing price data ##
#####################################
df_td_all %>%
left_join(
df_chain_hist
, by = "trade_date"
) %>%
filter(is.na(underlying))
# df_opt_hist
df_td_all %>%
left_join(
df_opt_hist
, by = c("trade_date" = "data_date")
)
df_opt_hist
# df_opt_hist
df_td_all %>%
left_join(
df_opt_hist
, by = c("trade_date" = "data_date")
)
# df_opt_hist
df_td_all %>%
left_join(
df_opt_hist
, by = c("trade_date" = "data_date")
) %>%
filter(is.na(underlying_symbol))
View(df_chain_hist)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(close != underlying_price)
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>% View()
l
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
.$date %>% distinct()
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
.$date
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
.$date %>% distinct()
distinct(c(1, 2, 1))
distinct(c("A", "B", "A"))
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
distinct(date)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
distinct(date) %>% View()
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
)
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.01) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.05) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs(close - underlying_price) > 0.10) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.01) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.005) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.0025) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.001) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>% View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.001) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>%
mutate(
diff = close - underlying
) %>%
View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.001) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>%
mutate(
diff = close - underlying_price
) %>%
View()
###############################################
## check for differences in underlying price ##
###############################################
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.0001) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>%
mutate(
diff = close - underlying_price
) %>%
View()
df_underlying_px %>%
select(date, close) %>%
left_join(
df_opt_hist %>% select(data_date, underlying_price)
, by = c("date" = "data_date")
) %>%
filter(abs((close - underlying_price)/close) > 0.001) %>%
group_by(date) %>%
summarize(
close = mean(close)
, underlying_price = mean(underlying_price)
) %>%
mutate(
diff = close - underlying_price
)
#################################################
## checking for missing price data for options ##
#################################################
df_opt_hist %>%
distinct(underlying, expiration, strike, type)
View(df_opt_hist)
#################################################
## checking for missing price data for options ##
#################################################
df_opt_hist %>%
distinct(underlying_symbol, expiration, strike, type)
#################################################
## checking for missing price data for options ##
#################################################
df_opt_hist %>%
distinct(underlying_symbol, expiration, strike, type) %>%
left_join(
df_chain_desc %>% select(expiration, d2x)
, by = "expiration"
)
df_opt_hist %>%
group_by(
underlying_symbol, type, expiration, strike
) %>%
summarize(
row_count = n()
)
df_opt_hist %>%
group_by(
underlying_symbol, type, expiration, strike
) %>%
summarize(
row_count = n()
) %>%
left_join(
df_chain_desc %>% select(expiration, d2x)
, by = "expiration"
)
df_opt_hist %>%
group_by(
underlying_symbol, type, expiration, strike
) %>%
summarize(
row_count = n()
) %>%
left_join(
df_chain_desc %>% select(expiration, d2x)
, by = "expiration"
) %>%
filter(row_count != (d2x + 1))
View(df_opt_hist)
df_opt_hist %>%
group_by(
underlying_symbol, type, expiration, strike
) %>%
summarize(
row_count = n()
) %>%
left_join(
df_chain_desc %>% select(expiration, d2x)
, by = "expiration"
) %>%
filter(row_count != (d2x + 1)) %>%
View()
df_td_all %>%
left_join(
df_opt_hist
, by = c("trade_date" = "data_date")
) %>%
filter(is.na(underlying_symbol))
df_td_all %>%
left_join(
df_chain_hist
, by = "trade_date"
) %>%
filter(is.na(underlying))
View(df_chain_hist)
df_opt_hist %>%
group_by(
underlying_symbol, type, expiration, strike
) %>%
summarize(
row_count = n()
) %>%
left_join(
df_chain_desc %>% select(expiration, d2x)
, by = "expiration"
) %>%
filter(row_count != (d2x + 1)) %>%
View()
#
df_chain_hist %>%
filter(expiration == ymd(20140402))
#
df_chain_hist %>%
filter(expiration == ymd(20150402))
df_opt_hist %>%
filter(type == "call") %>%
filter(underlying_symbol == "SPY") %>%
filter(expiration == ymd(20150402)) %>%
filter(strike == 206)
df_opt_hist %>%
filter(underlying_symbol == "SPY") %>%
filter(expiration == ymd(20150402)) %>%
filter(data_date == expiration)
backtestr::option_chain(
trade_date = ymd(20150402)
, underlying = "SPY"
, expiration = ymd(20150402)
)
backtestr::option_chain(
trade_date = ymd(20150402)
, underlying = "SPY"
, expiration = ymd(20150401)
)
backtestr::option_chain(
trade_date = ymd(20150401)
, underlying = "SPY"
, expiration = ymd(20150402)
)
# clearing shit out
rm(list=ls())
cat("\014")
# loading packages
library(tidyverse)
library(lubridate)
library(bizdays)
library(tictoc)
library(backtestr)
library(tidyquant)
# sourcing functions
source("function/missing_data.R")
source("function/chain_weekly.R")
source("function/chain_monthly.R")
# initializing bizdays libraries
load_rmetrics_calendars(2000:2020)
bizdays.options$set(default.calendar="Rmetrics/NYSE")
# setting underlying
underlying <- "SPY" # don't call this chr_underlying
# creating df_chain
df_chain <- chain_weekly(underlying)
#df_chain <- chain_monthly(underlying)
View(df_chain)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
df_opt_px_all
df_opt_px
df_opt_px
View(df_opt_px)
df_opt_px
