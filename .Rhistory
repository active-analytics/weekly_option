select(underlying, expiration, execution, realized_vol) %>%
left_join(
df_chain_hist %>%
select(underlying, expiration, trade_date, bid_swap_rate)
, by = c("underlying", "expiration")
) %>%
filter(trade_date == execution) %>%
select(underlying, expiration, realized_vol, bid_swap_rate) %>%
mutate(
vol_prem = bid_swap_rate - realized_vol
)
# a final report that puts together all the numbers that we are
# interested in
df_report <-
df_prem_vs_pnl %>%
left_join(
df_vol_prem
, by = c("underlying_symbol" = "underlying", "expiration")
) %>%
mutate(
pnl_ratio = pnl / premium
)
df_report
df_prem_exp
df_pnl_exp
View(df_pnl_exp)
View(df_prem_vs_pnl)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
#####################
## all trade dates ##
#####################
df_td_all <-
tibble(
trade_date = bizseq(from = "2014-01-03", to = "2018-12-29")
)
#dt_all <- bizseq(ymd(20140103), ymd(20181229))
#df_td_all <- tibble(trade_date = dt_all)
###################################################
## grabbing price data from yahoo with tidyquant ##
###################################################
df_underlying_px <-
tq_get("IWM", from = "2014-01-03", to = "2018-12-29")
########################################################
## grabbing volatility index from FRED with tidyquant ##
########################################################
# df_vol_index <-
#     tq_get(
#         "VIXCLS"
#         , get = "economic.data"
#         , from = "2014-01-03"
#         , to = "2018-12-29"
#     )
df_vol_index <-
read_csv("data_input/rvxdailyprices.csv")
df_vol_index$Date <- mdy(df_vol_index$Date)
df_spy <- read_csv("data_output/spy_weekly_2014_2018_pnl_master.csv")
df_iwm <- read_csv("data_output/iwm_weekly_2014_2018_pnl_master.csv")
df_spy %>%
filter(variation == 0.1) %>%
group_by(data_date) %>%
summarize(pnl = sum(dly_tot_pnl))
df_spy_daily <-
df_spy %>%
filter(variation == 0.1) %>%
group_by(data_date) %>%
summarize(pnl = sum(dly_tot_pnl)) %>%
mutate(ttd_pnl = cumsum(pnl))
df_spy_daily
df_spy_daily <-
df_spy %>%
filter(variation == 0.1) %>%
group_by(data_date) %>%
summarize(pnl = sum(dly_tot_pnl)) %>%
mutate(
ttd_pnl = cumsum(pnl)
underlying = "SPY"
)
df_spy_daily <-
df_spy %>%
filter(variation == 0.1) %>%
group_by(data_date) %>%
summarize(pnl = sum(dly_tot_pnl)) %>%
mutate(
ttd_pnl = cumsum(pnl)
,underlying = "SPY"
)
df_iwm_daily <-
df_iwm %>%
filter(variation == 0.1) %>%
group_by(data_date) %>%
summarize(pnl = sum(dly_tot_pnl)) %>%
mutate(
ttd_pnl = cumsum(pnl)
, underlying = "IWM"
)
(mean(df_spy_daily$pnl) / sd(df_spy_daily$pnl)) * sqrt(252)
(mean(df_iwm_daily$pnl) / sd(df_iwm_daily$pnl)) * sqrt(252)
df_all_daily <- bind_rows(df_spy_daily, df_iwm_daily)
df_all_daily %>%
ggplot() +
geom_line(aes(x=data_date, y = ttd_pnl, color = underlying))
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
write_csv(df_chain, "qqq_weekly_2014_2018_chain_desc.csv")
write_csv(df_chain_hist, "qqq_weekly_2014_2018_chain_hist.csv")
write_csv(df_opt_hist, "qqq_weekly_2014_2018_opt_hist.csv")
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
write_csv(df_pnl, "qqq_weekly_2014_2018_pnl_master.csv")
write_csv(df_trade, "qqq_weekly_2014_2018_trade_master.csv")
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
write_csv(df_chain, "dia_weekly_2014_2018_chain_desc.csv")
write_csv(df_chain_hist, "dia_weekly_2014_2018_chain_hist.csv")
write_csv(df_opt_hist, "dia_weekly_2014_2018_opt_hist.csv")
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
df_all_daily <-
bind_rows(
# df_spy_daily
# , df_iwm_daily
# , df_qqq_daily
# , df_dia_daily
df_fxi_daily
)
df_all_daily %>%
ggplot() +
geom_line(aes(x=data_date, y = ttd_pnl, color = underlying))
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/01_wrangler_market.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/script/02_wrangler_trade_pnl.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
source('~/files/ods/weekly_option/testing/iwm_spy_comparison.R', echo=TRUE)
######################
## loading packages ##
######################
library(tidyverse)
library(lubridate)
library(tidyquant)
library(bizdays)
# initializing bizdays libraries
load_rmetrics_calendars(2000:2020)
bizdays.options$set(default.calendar="Rmetrics/NYSE")
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
chr_underling <- "IWM"
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
chr_underling <- "IWM"
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
chr_underlying <- "IWM"
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
######################
## loading packages ##
######################
library(tidyverse)
library(lubridate)
library(tidyquant)
library(bizdays)
# initializing bizdays libraries
load_rmetrics_calendars(2000:2020)
bizdays.options$set(default.calendar="Rmetrics/NYSE")
source("function/vol_index.R")
#####################
## all trade dates ##
#####################
df_td_all <-
tibble(
trade_date = bizseq(from = "2014-01-03", to = "2018-12-29")
)
#dt_all <- bizseq(ymd(20140103), ymd(20181229))
#df_td_all <- tibble(trade_date = dt_all)
###################################################
## grabbing price data from yahoo with tidyquant ##
###################################################
df_underlying_px <-
tq_get("IWM", from = "2014-01-03", to = "2018-12-29")
########################################################
## grabbing volatility index from FRED with tidyquant ##
########################################################
# df_vol_index <-
#     tq_get(
#         "VIXCLS"
#         , get = "economic.data"
#         , from = "2014-01-03"
#         , to = "2018-12-29"
#     )
df_vol_index <-
vol_index(chr_underlying) %>%
read_csv()
df_vol_index$Date <- mdy(df_vol_index$Date)
######################
## loading packages ##
######################
library(tidyverse)
library(lubridate)
library(tidyquant)
library(bizdays)
# initializing bizdays libraries
load_rmetrics_calendars(2000:2020)
bizdays.options$set(default.calendar="Rmetrics/NYSE")
source("function/vol_index.R")
df_vol_index <-
vol_index(chr_underlying) %>%
read_csv()
df_vol_index$Date <- mdy(df_vol_index$Date)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
unlink('testing/weekly_option_data_integrity_test_cache', recursive = TRUE)
# Chunk 1: setup
knitr::opts_chunk$set(
echo = TRUE
)
options(width = 100)
# Chunk 2
######################
## loading packages ##
######################
library(tidyverse)
library(lubridate)
library(tidyquant)
library(bizdays)
# initializing bizdays libraries
load_rmetrics_calendars(2000:2020)
bizdays.options$set(default.calendar="Rmetrics/NYSE")
source("function/vol_index.R")
# Chunk 3
chr_underlying <- "EEM"
#####################
## reading in data ##
#####################
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_chain_desc.csv"
)
df_chain_desc <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_chain_hist.csv"
)
df_chain_hist <-read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_opt_hist.csv"
)
df_opt_hist <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_pnl_master.csv"
)
df_pnl <- read_csv(chr_path)
chr_path <-
paste0(
"data_output/", str_to_lower(chr_underlying)
, "_weekly_2014_2018_trade_master.csv"
)
df_trade <- read_csv(chr_path)
View(df_chain_desc)
